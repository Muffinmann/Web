{% extends '__base__.html' %}

{% block title %} Blogs {% endblock %}

{% block beforehead %}

<script>
function initVM(data){
	console.log(data);
	var vm = new Vue({
		el: '#vm',
		data: {
			blogs: data.blogs,
			page: data.page
		},
		methods: {
			gotoFirstPage: function(){
				gotoPage(1);
			},
			gotoLastPage: function(){
				gotoPage(this.page.page_count);
			},
			previous: function(){
				gotoPage(this.page.page_index - 1);
			},
			next: function(){
				gotoPage(this.page.page_index + 1);
			},
			edit_blog: function(blog){
				location.assign('/manage/blogs/edit?id=' + blog.id);
			},
			delete_blog: function(blog){
				if (confirm('Are you sure to delte\"' + blog.name + '\"?')){
					postJSON('/api/blogs/' + blog.id + '/delete', function(err, r){
						if (err){
							return alert(err.message ||  err.error || err);
						}
						refresh();
					});
				}
			}
		}
	});
	$('#vm').show();
}

$(function() {
    getJSON('/api/blogs', {
        page: {{ page_index }}
    }, function (err, results) {
        if (err) {
            return fatal(err);
        }
        $('#loading').hide();
        initVM(results);
    });
});
</script>

{% endblock %}

{% block content %}
<div class="uk-grid">
	<div class="uk-width-1-1 uk-margin-bottom">
		<ul class="uk-breadcrumb">
			<li><a href="/manage/comments">Comments</a></li>
			<li class="uk-active"><span>Blogs</span></li>
			<li><a href="/manage/users">Users</a></li>
		</ul>
	</div>

	<div id="error" class="uk-width-1-1"></div>

	<div id="loading" class="uk-width-1-1 uk-text-center">
		<span><i uk-spinner></i> Loading...</span>
	</div> 

	<div id="vm" class="uk-width-1-1">
		<a href="/manage/blogs/create" class="uk-button uk-button-primary uk-button-text"><i uk-icon="plus"></i> New Blog</a>
		<table class="uk-table uk-table-striped">
			<thead>
				<tr>
					<th class="uk-table-expand uk-text-left">Title</th>
					<th class="uk-text-left">Author</th>
					<th class="uk-text-left">Created At</th>
					<th class="uk-text-left">Operate</th>
				</tr>
			</thead>
			<tbody>
				<tr v-for="blog in blogs">
					<td>
						<a target="_blank" v-bind:href="'/blog/'+blog.id" v-text="blog.name" style="color: #44474A"></a>
					</td>	
					<td>
						<a target="_blank" v-bind:href="'/user/'+blog.user_id" v-text="blog.user_name" style="color: #44474A"></a>
					</td>
					<td>
						<span v-text="blog.created_at.toDateTime()"></span>
					</td>
					<td>
						<a href="#0" v-on:click="edit_blog(blog)" style="color: #44474A">Edit</a>
						<a href="#0" v-on:click="delete_blog" style="color: #AF0000">Delete</a>
					</td>
				</tr>			
			</tbody>
		</table>
		<div class="uk-width-1-1 uk-text-center">
			<ul class="uk-pagination">
				<li><a v-on:click="gotoFirstPage()"><i uk-icon="chevron-double-left"></i></a></li>
				<li v-if="! page.has_previous" class="uk-disabled"><span><i uk-icon="chevron-left"></i></span> </li>
				<li v-else><a v-on:click="previous()" href="#0"><i uk-icon="chevron-left"></i></a></li>
				<li class="uk-active"><span v-text="page.page_index"></span></li>
				<li v-if="! page.has_next" class="uk-disabled"><span><i uk-icon="chevron-right"></i></span></li>
				<li v-else><a v-on:click="next()" href="#0"><i uk-icon="chevron-right"></i></a></li>
				<li><a v-on:click="gotoLastPage()"><i uk-icon="chevron-double-right"></i></a></li>
			</ul>
		</div>
	</div>
</div>

{% endblock %}