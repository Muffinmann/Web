{% extends '__base__.html' %}

{% block title %} Blogs {% endblock %}

{% block beforehead %}

<script>
function initVM(data){
	console.log(data);
	var vm = new Vue({
		el: '#vm',
		data: {
			blogs: data.blogs,
			page: data.page
		},
		methods: {
			gotoFirstPage: function(){
				gotoPage(1);
			},
			gotoLastPage: function(){
				gotoPage(this.page.page_count);
			},
			previous: function(){
				gotoPage(this.page.page_index - 1);
			},
			next: function(){
				gotoPage(this.page.page_index + 1);
			},
			edit_blog: function(blog){
				location.assign('/manage/blogs/edit?id=' + blog.id);
			},
			delete_blog: function(blog){
				if (confirm('Are you sure to delete\"' + blog.name + '\"?')){
					postJSON('/api/blogs/' + blog.id + '/delete', function(err, r){
						if (err){
							return alert(err.message ||  err.error || err);
						}
						refresh();
					});
				}
			}
		}
	});
	$('#vm').show();
}

$(function() {
    getJSON('/api/blogs', {
        page: {{ page_index }}
    }, function (err, results) {
        if (err) {
            return fatal(err);
        }
        $('#loading').hide();
        initVM(results);
    });
});
</script>

{% endblock %}

{% block content %}
<section>
	<h4>Manage</h4>
	<div>
		<ul class="actions">
			<li><a href="/manage/comments">Comments</a></li>
			<li class="active"><span>Blogs</span></li>
			<li><a href="/manage/users">Users</a></li>
		</ul>
	</div>

	<div id="error" class="uk-width-1-1"></div>

	<div id="loading" class="uk-width-1-1 uk-text-center">
		<span><i uk-spinner></i> Loading...</span>
	</div> 

	<div id="vm" class="uk-width-1-1">
		<a href="/manage/blogs/create" class="button small">New Blog</a>
		<hr>
		<table class="table-wrapper">
			<thead>
				<tr>
					<th>Title</th>
					<th>Author</th>
					<th>Created At</th>
					<th>Operation</th>
				</tr>
			</thead>
			<tbody>
				<tr v-for="blog in blogs">
					<td>
						<a target="_blank" v-bind:href="'/blog/'+blog.id" v-text="blog.name" ></a>
					</td>	
					<td>
						<span v-text="blog.user_name" ></span>
					</td>
					<td>
						<span v-text="blog.created_at.toDateTime()"></span>
					</td>
					<td>
						<a href="#0" v-on:click="edit_blog(blog)" style="color: #ffffff">Edit</a>
						<a href="#0" v-on:click="delete_blog(blog)" style="color: #d05">Delete</a>
					</td>
				</tr>			
			</tbody>
		</table>
		<hr>
		<div>
			<ul class="actions">
				<li><a v-on:click="gotoFirstPage()"><span class="icon solid fa-chevron-left "></span><span class="icon solid fa-chevron-left "></span></a></li>
				<li v-if="! page.has_previous" class="disabled"><span class="icon solid fa-chevron-left"></span></li>
				<li v-else><a v-on:click="previous()" href="#0"><span class="icon solid fa-chevron-left"></a></li>

				<li class="uk-active"><span v-text="page.page_index"></span></li>

				<li v-if="! page.has_next" class="disabled"><span class="icon solid fa-chevron-right"></i></span></li>
				<li v-else><a v-on:click="next()" href="#0"><span class="icon solid fa-chevron-right"></span></a></li>
				<li><a v-on:click="gotoLastPage()"><span class="icon solid fa-chevron-right"></span><span class="icon solid fa-chevron-right"></span></a></li>
			</ul>
		</div>
	</div>
</section>

{% endblock %}