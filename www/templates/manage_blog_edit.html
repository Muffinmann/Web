{% extends '__base__.html'%}

{% block title %} Edit Blog {% endblock %} 

{% block beforehead %}

<script>
var
	ID = '{{id}}',
	action = '{{ action }}';

function initVM(blog){
	var vm = new Vue({
		el: '#vm',
		data: blog,
		methods: {
			submit: function(event) {
				event.preventDefault();
				var $form = $('#vm').find('form');
				$form.postJSON(action, this.$data, function(err,r) {
					if (err) {
						$form.showFormError(err);
					}
					else{
						return location.assign('/manage/blogs')
					}
				});
			}
		}
	});
	console.log('vm.data',vm.data);
	$('#vm').show();
	//$('#vm').find('input').val(vm.blog.summary);
}


$(function () {
	console.log('ID=',ID);
    if (ID) {
        getJSON('/api/blogs/' + ID, function (err, blog) {
            if (err) {
                return fatal(err);
            }
            $('#loading').hide();
            initVM(blog);
        });
    }
    else {
        $('#loading').hide();
        initVM({
            name:'',
            summary:'',
            content:''
        });
    }
});

</script>

{% endblock %}


{% block content %}
<section>
<h4>New Blog</h4>
<div>
	<ul class="actions">
		<li><a href="/manage/users">User</a></li>
		<li><a href="/manage/comments">Comments</a></li>
		<li><a href="/manage/blogs">Blogs</a></li>
	</ul>
</div>

<div id="error" class="uk-width-1-1">
</div>

<div id="loading" class="uk-width-1-1 uk-text-center">
	<span uk-spinner>Loading...</span>
</div>

<div id="vm" class="uk-width-1-1">
	<form v-on:submit="submit" class="uk-form-stacked">
		<div class="uk-alert uk-alert-danger uk-hidden"></div>
		<div class="uk-margin-top">
			<label class="uk-form-label">Title:</label>
			<div class="uk-form-controls">
				<input class="uk-input uk-form-width-large" v-model="name" name="name" type="text">
			</div>
		</div>
		<div class="uk-margin-top">
			<label class="uk-form-label">Abstract:</label>
			<div class="uk-form-controls">
				<textarea class="uk-textarea" v-model="summary" name="summary" rows="4" style="resize: none;"></textarea>
			</div>
		</div>
		<div class="uk-margin-top">
			<label class="uk-form-label">Content:</label>
			<div class="uk-form-controls">
				<textarea class="uk-textarea" v-model="content" name="content" rows="12" style="resize: none;"></textarea>
			</div>
		</div>
		<div class="uk-margin-top">
			<button type="submit" class="uk-button uk-button-primary uk-button-text">Save</button>
			<a href="/manage/blogs" class="uk-button"><i class="uk-icon"></i>Cancel</a>
		</div>
	</form>
</div>
</section>
{% endblock %}