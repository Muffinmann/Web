{% extends '__base__.html' %}

{% block title %}{{blog.name}}{% endblock %}

{% block beforehead %}

<script>
var comment_url = '/api/blogs/{{blog.id}}comments';

$(function(){
	var $form = $('#form-comment');
	$form.submit(function(e){
		e.preventDefault();
		$form.showFormError('');
		var content = $form.find('textarea').val().trim();
		if (content===''){
			return $form.showFormError('Comments can not be empty!');
		}
		$form.postJSON(comment_url,{content: content}, function(err, result){
			if (err){
				return $form.showFormError(err);
			}
			refresh();
		});
	});
});

</script>
{% endblock %}

{% block content %}
<div class="uk-grid">
	<div class="uk-width-1-1">
		<article class="uk-article">
			<h2>{{ blog.name }}</h2>
			<p class="uk-article-meta">posted at {{ blog.created_at|datetime }}</p>
			<p>{{ blog.html_content|safe }} test content</p>
		</article>
		<hr>

	{% if __user__ %}
		<h3>Leave a Comment</h3>
		<article class="uk-comment">
			<form id="form-comment" class="uk-form">
				<fieldset class="uk-fieldset">
					<div class="uk-alert uk-alert-danger uk-hidden"></div>
					<div class="uk-margin uk-form-controls">
						<textarea class="uk-textarea" rows="4" cols="50" placeholder="your comments here" ></textarea>
					</div>
					<div class="uk-margin">
						<button type="submit" class="uk-button uk-button-primary uk-button-text">commit</button>
					</div>
				</fieldset>
				
			</form>
		</article>
	{% endif %}
	</div>
</div>

{% endblock %}